<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skeniraj QR kod</title>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
    <h1>Skeniraj QR kod</h1>
    <div id="reader" style="width:600px; height: 400px;"></div>
    <div id="result" style="margin-top: 20px; font-size: 20px;"></div>

    <script>
        const html5QrCode = new Html5Qrcode("reader");

        // Funkcija koja se poziva kada je QR kod uspešno skeniran
        function onScanSuccess(qrCodeMessage) {
            document.getElementById("result").innerText = "Skenirani QR kod: " + qrCodeMessage;

            // Pripremi podatke za slanje u Google Sheets
            const data = {
                pfr: qrCodeMessage, // Preuzmi PFR broj iz QR koda
                timestamp: new Date().toISOString(), // Uzmi trenutni datum i vreme
            };

            // Šalji podatke u Google Sheets
            fetch('https://sheets.googleapis.com/v4/spreadsheets/1ZCf7JHeAG21TM9BWY9wLVAZ0GnvaHhI7hLzxhERHMZ0/values/Sheet1!A1:append?valueInputOption=RAW&key=YOUR_API_KEY', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer YOUR_ACCESS_TOKEN` // Ako koristiš OAuth 2.0
                },
                body: JSON.stringify({
                    values: [
                        [data.pfr, data.timestamp] // Upisuje PFR i vreme
                    ]
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Uspešno upisano:', data);
            })
            .catch((error) => {
                console.error('Greška:', error);
            });
        }

        // Opcije za skeniranje
        const config = {
            fps: 10, // broj frejmova u sekundi
            qrbox: 250 // veličina kvadrata za skeniranje
        };

        // Pokreni skener
        html5QrCode.start(
            { facingMode: "environment" }, // koristi zadnju kameru (kamera za skeniranje)
            config,
            onScanSuccess)
        .catch(err => {
            console.error("Greška prilikom pokretanja skenera:", err);
        });
    </script>
</body>
</html>
