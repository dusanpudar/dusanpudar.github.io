<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Code Scanner</title>
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
    <h1>QR Code Scanner</h1>
    <div id="reader" style="width: 600px;"></div>

    <script>
        const html5QrCode = new Html5Qrcode("reader");

        // Postavljanje skener
        html5QrCode.start(
            { facingMode: "environment" }, // Koristi kameru okrenutu ka spolja
            {
                fps: 10, // Frames per second
                qrbox: 250 // Veličina QR box-a
            },
            (decodedText, decodedResult) => {
                console.log(`Decoded text: ${decodedText}`);
                // Poziv funkcije za unos podataka u Google Sheet
                addToGoogleSheet(decodedText);
                html5QrCode.stop();
            },
            (errorMessage) => {
                // Prikazivanje greške (ako je potrebno)
                console.warn(`QR code scan error: ${errorMessage}`);
            }
        ).catch(err => {
            console.error(`Failed to start scanning: ${err}`);
        });

        // Funkcija za unos podataka u Google Sheet
        function addToGoogleSheet(data) {
            const sheetId = '1ZCf7JHeAG21TM9BWY9wLVAZ0GnvaHhI7hLzxhERHMZ0'; // tvoj Google Sheet ID
            const apiKey = '320647357285-2slvkr2jadah6hch048isjjoejhg3u8p.apps.googleusercontent.com'; // tvoj API ključ
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1!A1:append?valueInputOption=USER_ENTERED&key=${apiKey}`;
            
            const params = {
                range: 'Sheet1!A1',
                majorDimension: 'ROWS',
                values: [[data, new Date().toISOString()]] // dodavanje podataka i trenutnog vremena
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(params)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
                alert('Podaci su uspešno sačuvani!');
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Došlo je do greške prilikom čuvanja podataka.');
            });
        }
    </script>
</body>
</html>
