<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skeniranje računa</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h1>Skeniraj račun</h1>
    <button id="authorize_button">Autorizuj</button>
    <button id="scanButton" style="display: none;">Skeniraj QR kod</button>

    <script>
        const CLIENT_ID = '320647357285-2slvkr2jadah6hch048isjjoejhg3u8p.apps.googleusercontent.com';
        const API_KEY = 'TVOJ_API_KLJUČ'; // Postavi svoj API ključ
        const SHEET_ID = '1ZCf7JHeAG21TM9BWY9wLVAZ0GnvaHhI7hLzxhERHMZ0';
        
        const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        const SCOPES = "https://www.googleapis.com/auth/spreadsheets";

        function handleClientLoad() {
            gapi.load("client:auth2", initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES,
            }).then(() => {
                document.getElementById("authorize_button").onclick = handleAuthClick;
                document.getElementById("scanButton").onclick = () => {
                    // Ovde dodaj kod za skeniranje QR koda
                    const pfr = '123456789'; // Primer PFR broja
                    const time = new Date().toISOString(); // Trenutno vreme
                    const amount = '1500'; // Primer iznosa

                    addDataToSheet(pfr, time, amount);
                };
            });
        }

        function handleAuthClick(event) {
            gapi.auth2.getAuthInstance().signIn();
        }

        async function addDataToSheet(pfr, time, amount) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1!A1:C1:append?valueInputOption=USER_ENTERED`;

            const data = {
                values: [
                    [pfr, time, amount]
                ]
            };

            const response = await gapi.client.request({
                path: url,
                method: 'POST',
                body: JSON.stringify(data),
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.status === 200) {
                console.log('Podaci su uspešno dodati u Sheet!');
            } else {
                console.error('Došlo je do greške:', response.result.error.message);
            }
        }

        // Učitaj klijent na učitavanje stranice
        window.onload = handleClientLoad;
    </script>
</body>
</html>
